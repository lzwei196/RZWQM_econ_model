<html>
        <head>
            <link rel="stylesheet" href="content.css">
        </head>

<body>
  <div id = 'carbonPrice'>
  </div>
      <div class="calculate-button" align = "center" id="calculate-button">
        <button type="button" class="btn btn-danger btn-rounded" onclick="execute()">Commence Simulation</button>
      </div>

      <br>
      <br>

      <div class="calculate-button" align = "center" id="nsb-button">
        <button type="button" class="btn btn-danger btn-rounded" onclick="scraperFn()">Commence Economical analysis</button>
      </div>

      <br>
      <br>

      <div>
        <h3 class="nsb-price" align = "center" >Net Social Benefit$ï¼š</h3>
      </div>

<script>
  //loading up the required depenency variable
    var app = require('electron').remote; 
    var dialog = require('electron').remote.dialog;
    var fs = require('fs');
    var plugin = require('./js/plugin.js');
    var cropPrice = require('./js/scraper.js').commodityPrice;

    var constantRaw = fs.readFileSync("constants.json")
    var constant = JSON.parse(constantRaw)

    function readRzwqm(){
      plugin.readRzwqm();
    }

    //user would help to locate the Rzwqm.DAT file first, then with the choice they made, execute the simulation.
    function writeRzwqm(){
      plugin.writeRzwqm();
    }

    function readData(){
      plugin.readData();
    }

    function scraperFn(){
      cropPrice('TFGRAIN/CORN.json');
      console.log('test')
    }

    function execute(){
      //writeRzwqm();
      let locate = plugin.locateTheReleaseFile();
      writeRzwqm();
      const exec = require('child_process').exec;
      let stringHere = 'start RZWQMrelease.exe';
      //let stringHere = "C:\\RZWQM2\\projects\\GHG-SE\\GHG-SE-FD\\RZWQMrelease.exe";
      //And run the application from the current folder
      exec(stringHere,{cwd:locate} ,function(err, stdout, stderr){ 
        if (err) {
          alert(err)
          console.log(err)
        }
    // node couldn't execute the command
  // the *entire* stdout and stderr (buffered)
      readData();
     });
};

    function nsbCalc(){
      //read data from the output
      var output = plugin.readData();
      var yieldRaw = output.yield;
      //console.log(yieldRaw)
      let yield = [];
      var revenue = 0;
      //taking out the final yield with the the number of the day
      yieldRaw.forEach(function(element,index){
        if(element != 0 && yieldRaw[index+1] == 0){
          yield.push(element)
        }
      });
      console.log(yieldRaw)
      //get the revenue from corn
      yield.forEach(function(element){
        revenue += 193.54*4.2*(element/1000);
      })
      
      //if the choice is subirrigation:
      var costConstant = constant["subrirrigation"]["fixed"];
      var fixedCost = 0;
      costConstant.forEach(function(element){
        fixedCost = fixedCost + 4.2*(Object.values(element)[0])
      })

      var nsb = revenue - fixedCost;


    }

</script>
        
    </body>

    </html>